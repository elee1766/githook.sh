# Caddyfile for githook.sh
# Browsers get HTML, everything else gets the script

{
	admin off
	auto_https off
}

:80 {
	root * /srv/site

	# Detect browsers - they all include Mozilla in User-Agent
	@browser {
		header_regexp User-Agent (?i)Mozilla
	}

	# Health check
	handle /health {
		respond "OK" 200
	}

	# llms.txt served as plain text
	handle /llms.txt {
		header Content-Type "text/plain; charset=utf-8"
		file_server
	}

	# docs page
	handle /docs* {
		file_server
	}

	# ?code query param forces script download
	@code query code=*
	handle @code {
		rewrite * /githook.sh
		header Content-Type "text/plain; charset=utf-8"
		file_server
	}

	# Browsers get HTML
	handle @browser {
		rewrite * /index.html
		file_server
	}

	# Everything else (curl, wget, etc.) gets the script
	handle {
		rewrite * /githook.sh
		header Content-Type "text/plain; charset=utf-8"
		file_server
	}

	log {
		output stdout
		format console
	}
}
